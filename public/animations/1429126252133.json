{"name":"Starfield","filename":"1429126252133.js","author":"Ben","code":"// example code, renders a basic rainbow\r\nvar tweenedValues = {\r\n\thue: 0\r\n};\r\n\r\nvar speed = 0.05;\r\n\r\nvar spreadX = 52,\r\n    spreadY = 34,\r\n    spreadZ = 12;\r\n    \r\nvar Star = function() {\r\n    this.init();\r\n};\r\nStar.prototype = {\r\n    init: function() {\r\n        this.position = new THREE.Vector3(\r\n            (Math.random() - 0.5) * spreadX,\r\n            (Math.random() - 0.5) * spreadY,\r\n            (Math.random() + 0.0000001) * spreadZ\r\n        );\r\n        this.color = new Color(0xFFFFFF);\r\n    },\r\n    update: function() {\r\n        this.position.z -= speed;\r\n        if (this.position.z < 0) {\r\n            this.init();\r\n        }\r\n    },\r\n    draw: function(display) {\r\n        var centerX = display.cols / 2,\r\n            centerY = display.rows / 2;\r\n            \r\n        var x = Math.round((this.position.x / this.position.z) + centerX);\r\n        var y = Math.round((this.position.y / this.position.z) + centerY);\r\n        \r\n        if (x < 0 || x >= display.cols || y < 0 || y >= display.rows) {\r\n            this.init();\r\n            return;\r\n        }\r\n        var index = y * display.cols + x;\r\n        var c = this.color.clone();\r\n        c.multiplyScalar(Math.max(0,(spreadZ-this.position.z-5) / spreadZ));\r\n        display.leds[index] = c;\r\n    }\r\n}\r\n\r\nreturn {\r\n    initStarfield: function(count) {\r\n        this.starfield = [];\r\n        for (var i=0;i<count; i++) {\r\n            this.starfield.push(new Star());\r\n        }\r\n    },\r\n\tinit: function(display,timeline) {\r\n\t\tthis.display = display;\r\n        debugger;\r\n        this.initStarfield(50);\r\n        \r\n        var starfield = this.starfield;\r\n        setInterval(function() {\r\n            for (var i=0; i < starfield.length; i++) {\r\n                starfield[i].update();\r\n            }\r\n        },1000/30);\r\n      \t/*display.tween(tweenedValues,{\r\n          to: {z: },\r\n          duration: 5000,\r\n          repeat: Infinity,\r\n          yoyo: true,\r\n          delay: 0,\r\n          easing: TWEEN.Easing.Cubic.InOut\r\n        });*/\r\n\t},\r\n\tonUpdate: function(display, data) {\r\n\t\tvar c = null;\r\n        \r\n        display.clear();\r\n        for (var i=0; i < this.starfield.length; i++) {\r\n            this.starfield[i].draw(display);\r\n        }\r\n\t}\r\n};","publish":true,"script":{}}